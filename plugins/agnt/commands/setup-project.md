---
description: "Configure scripts and proxies to auto-start when opening this project"
allowed-tools: ["mcp__devtool__detect", "Read", "Write", "Edit", "Bash", "AskUserQuestion"]
---

Set up project-level automation using Claude Code hooks. This will configure scripts and proxies to start automatically when you open this project.

## Steps

### 1. Detect Project Type

First, detect the project to find available scripts:

```
detect {path: "."}
```

### 2. Ask About Scripts to Auto-Start

Based on the detected scripts, ask the user which ones should run on project start:

Use AskUserQuestion to present the available scripts (dev, start, test, build, etc.) and ask:
- "Which scripts should auto-start when you open this project?"
- Allow multiple selections (multiSelect: true)
- Common choices: dev server, watch mode, test watcher

### 3. Ask About Proxy Configuration

Ask the user if they want to set up a reverse proxy for browser debugging:

Use AskUserQuestion:
- "Do you want to auto-start a debugging proxy?"
- If yes, ask for:
  - Target URL (e.g., http://localhost:3000)
  - Proxy ID (e.g., "dev")

### 4. Generate the Hook Configuration

Create or update `.claude/settings.json` with a SessionStart hook:

```json
{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/agnt-setup.sh"
          }
        ]
      }
    ]
  }
}
```

### 5. Create the Setup Script

Create `.claude/hooks/agnt-setup.sh` based on user selections:

```bash
#!/bin/bash
# Auto-generated by agnt setup-project command
set -e

# Wait for Claude Code to fully initialize
sleep 2

# Start configured processes via agnt daemon
# (Scripts and proxies configured by user)

# Example for a dev server:
# agnt serve --tool run '{"script_name": "dev", "mode": "background"}'

# Example for a proxy:
# agnt serve --tool proxy '{"action": "start", "id": "dev", "target_url": "http://localhost:3000"}'

exit 0
```

Make it executable:
```bash
chmod +x .claude/hooks/agnt-setup.sh
```

### 6. Handle Existing Configuration

If `.claude/settings.json` already exists:
1. Read the existing file
2. Merge the new SessionStart hook with existing hooks
3. Don't overwrite other settings

### 7. Summary

After setup, inform the user:
- The hook configuration location: `.claude/settings.json`
- The startup script location: `.claude/hooks/agnt-setup.sh`
- How to modify: edit the script directly or re-run `/setup-project`
- How to disable: remove the SessionStart hook from settings.json

## Notes

- Scripts run in background mode so they don't block Claude Code startup
- Proxies are started after a short delay to allow dev servers to initialize
- The setup script uses the agnt daemon which persists across sessions
- Users can manually edit `.claude/hooks/agnt-setup.sh` to customize behavior
