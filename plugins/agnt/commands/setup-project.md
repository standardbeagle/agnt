---
description: "Configure scripts and proxies to auto-start when opening this project"
allowed-tools: ["mcp__devtool__detect", "Read", "Write", "AskUserQuestion"]
---

Configure project-level automation by creating a `.agnt.kdl` configuration file. The agnt plugin's SessionStart hook will read this file and auto-start your configured services.

## Steps

### 1. Detect Project Type

First, detect the project to find available scripts:

```
detect {path: "."}
```

### 2. Ask About Scripts to Auto-Start

Based on the detected scripts, use AskUserQuestion to ask:

**Question**: "Which scripts should auto-start when you open this project?"
- Present available scripts (dev, start, serve, watch, etc.)
- Allow multiple selections (multiSelect: true)
- Common choices: dev server, watch mode

### 3. Ask About Proxy Configuration

Use AskUserQuestion to ask:

**Question**: "Do you want to auto-start a debugging proxy?"

If yes, ask:
- **Proxy ID**: A short name (e.g., "dev", "app")
- **Port detection**: "auto" to detect from script output, or a specific port number
- **Which script**: Which script's port to monitor (usually the dev server)

### 4. Write .agnt.kdl Configuration

Create or update `.agnt.kdl` in the project root with KDL format:

```kdl
// .agnt.kdl - agnt project configuration
// Auto-generated by /setup-project command

// Scripts to auto-start on session open
scripts {
    // script-name auto-start=true|false
    dev auto-start=true
}

// Proxy configuration
proxy "dev" {
    // Which script to watch for port detection
    script "dev"

    // Port detection: "auto" or specific port number
    port-detect "auto"

    // Fallback port if auto-detection fails
    fallback-port 3000

    // Optional: specific target host (default: localhost)
    // host "localhost"
}
```

### 5. Explain What Happens

After creating the config, inform the user:

1. **On next session start**: The agnt plugin's SessionStart hook will:
   - Read `.agnt.kdl`
   - Start configured scripts in background mode
   - Wait for the dev server to start
   - Auto-detect the port from script output (looks for patterns like "localhost:3000", "port 3000", etc.)
   - Start the proxy pointing to the detected port

2. **Port auto-detection**: agnt watches for common patterns:
   - `localhost:XXXX`
   - `127.0.0.1:XXXX`
   - `listening on port XXXX`
   - `started on :XXXX`
   - Falls back to `fallback-port` if detection fails

3. **To modify**: Edit `.agnt.kdl` directly or re-run `/setup-project`

4. **To disable**: Delete `.agnt.kdl` or set `auto-start=false` on scripts

## Example Configuration

For a typical Node.js project:

```kdl
scripts {
    dev auto-start=true
}

proxy "dev" {
    script "dev"
    port-detect "auto"
    fallback-port 3000
}
```

For a project with multiple services:

```kdl
scripts {
    dev auto-start=true
    api auto-start=true
}

proxy "frontend" {
    script "dev"
    port-detect "auto"
    fallback-port 3000
}

proxy "backend" {
    script "api"
    port-detect "auto"
    fallback-port 8080
}
```
